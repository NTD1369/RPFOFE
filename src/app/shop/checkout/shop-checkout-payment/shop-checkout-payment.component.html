<div class="center-wrap"  >
    <div class="maintenance-card" style="margin: auto;    width: 100%;">
        <div class="maintenance-row">
            <div class="col-md-12">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <a (click)="backpage()" class="back-btn">
                            <i class="fa fa-arrow-left fa-2x mr-2" aria-hidden="true"></i>
                        </a>
                        <label for="item-searchbar" class="section-title">{{'Sumary' | translate}}</label>
                    </div>
                    <div class="col-md-6 text-right">
                        <!-- <a class="btn button-dis border-radius-5 mr-2 font-size-14" (click)="openPromotionModal(ManualPromotion)">
              Discount
            </a> -->
                    </div>
                </div>
                <div class="row">

                    <div class="col-md-12">
                        <div class="right-section p-0">

                            <ng-container>
                                <div class="bill-info-wrap">

                                    <div class="bill-info">
                                        <p class="bill-number"> {{'Bill No' | translate}}: {{this.order?.transId}}</p>
                                        <p class="bill-date">{{'Date' | translate}}: {{this.order?.createdOn | date: this.authService.loadFormat().dateFormat}}</p>
                                        <p class="bill-number" *ngIf="this.order?.contractNo!==null && this.order?.contractNo!==undefined && this.order?.contractNo!==''"> Contract No: {{this.order?.contractNo}}</p>

                                        <!-- <p class="bill-time">Time: {{this.invoice?.createdOn | date:'HH:mm:ss'}}</p> -->
                                    </div>
                                    <div class="bill-info" *ngIf="this.order?.customer!==null && this.order?.customer!==undefined">
                                        <p class="bill-number"> {{'Customer Name' | translate}}: {{this.order?.customer?.customerName || this.order?.customer?.name}}
                                        </p>
                                        <p class="bill-date"> {{'Phone' | translate}}: {{this.order?.customer?.phone || this.order?.customer?.mobile}}</p>

                                    </div>

                                </div>
                                <div class="bill-wrapper">
                                    <div class="table-wrap">
                                        <div class="bill-table custom-table">
                                            <div class="t-head">
                                                <div class="t-row">
                                                    <div class="t-cell cell-action" style="max-width: 60px!important;">
                                                        <p></p>
                                                    </div>
                                                    <div class="t-cell cell-desc">
                                                        <p>{{'Description' | translate}}</p>
                                                    </div>
                                                    <!-- <div class="t-cell cell-quantity" style="max-width: 70px!important;">
                                                        <p>{{'UoM' | translate}}</p>
                                                    </div> -->
                                                    <div class="t-cell cell-quantity" style="max-width: 170px!important;">
                                                        <p>{{'Original Quantity' | translate}}</p>
                                                    </div>
                                                    <!-- <div class="t-cell cell-quantity" style="max-width: 100px!important;">
                      <p>Open Quantity</p>
                    </div> -->
                                                    <div class="t-cell cell-quantity" style="max-width: 170px!important;">
                                                        <p>{{'Checked Quantity' | translate}}</p>
                                                    </div>
                                                    <!-- <div class="t-cell cell-quantity" style="max-width: 160px!important;">
                                                        <p>{{'Price' | translate}}</p>
                                                    </div> -->
                                                    <div class="t-cell cell-total" style="max-width: 160px!important; text-align: right;" >
                                                        <p>{{'Total' | translate}}</p>
                                                    </div>
                                                    <!-- <div class="mr-2" style="min-width: 40px!important;">


                                                    </div> -->
                                                </div>
                                            </div>
                                            <!-- -->
                                            <!-- <div class="t-body mb-2" style="min-height: 300px;">
                                                <ng-container *ngFor="let item of filterNotBOM(this.order?.lines)"> 
                                                    <div class="t-row">
                                                        <div class="t-cell cell-action" style="max-width: 60px!important;">
                                                            <p *ngIf="item.lineTotal===0">
                                                                <i style="    color: orangered; font-size:20px" class="fas fa-gift"></i>
                                                            </p>
                                                        </div>
                                                        <div class="t-cell cell-desc" (click)="ele.class = ele.class == 'showChildren' ? 'hideChildren' :  'showChildren'">
                                                            <p>
                                                                {{item.itemCode}} <i class="fas fa-angle-down fa-2x" *ngIf="filterSerial(order?.serialLines, item.itemCode, item.uomCode).length > 0"></i>
                                                                <i class="fas fa-angle-down fa-2x" *ngIf="filterBOM(order?.lines, item.itemCode, '').length > 0"></i>

                                                            </p>
                                                            <br>
                                                            <p>

                                                                {{item.description}} 
                                                            </p>
                                                        </div>
                                                        <div class="t-cell cell-total" style="max-width: 60px!important;">
                                                            <p>{{item.uomCode}}</p>
                                                        </div>
                                                        <div class="t-cell cell-quantity" style="max-width: 170px!important;">
                                                            <p>{{item.quantity | number}}</p>
                                                        </div>

                                                        <div class="t-cell cell-quantity" style="max-width: 170px!important;">
                                                            <p>{{item.checkedQty | number}}</p>
                                                        </div>

                                                        <div class="t-cell cell-total" style="max-width: 160px!important;"> 
                                                            <ng-container *ngIf="item?.promoPrice!==null && item?.promoPrice!==item.price">
                                                                <p class="mr-2 textOrigionalX"> {{item.price | number}}</p>
                                                                <p class="mr-2 textPromotion"> {{item?.promoPrice | number}}</p>

                                                            </ng-container>
                                                            <ng-container *ngIf="item?.promoPrice===null || item?.promoPrice===item.price">
                                                                <p class="mr-2 textPromotion"> {{item.price | number}}</p>
                                                            </ng-container>
                                                        </div>
                                                        <div class="t-cell cell-total" style="max-width: 160px!important;">
                                                            <ng-container *ngIf="item?.promoLineTotal!==null && item?.promoLineTotal!==item.lineTotal">
                                                                <p class="mr-2 textOrigionalX"> {{item.lineTotal | number}}</p>
                                                                <p class="mr-2 textPromotion"> {{item?.promoLineTotal | number}}</p>

                                                            </ng-container>
                                                            <ng-container *ngIf="item?.promoLineTotal===null || item?.promoLineTotal===item.lineTotal">
                                                                <p class="mr-2 textPromotion"> {{item.lineTotal | number}}</p>
                                                            </ng-container>

                                                        </div>
                                                        <div class="mr-2" style="min-width: 40px!important;">

                                                        </div>
                                                    </div>

                                                    <div [ngClass]="{ hideChildren : ele.class !== 'showChildren' }" #ele>
                                                        <div class="t-row" *ngFor="let itemBOM of filterBOM(order?.lines, item.itemCode, '')">
                                                            <div class="t-cell cell-action" style="max-width: 60px!important;">

                                                            </div>

                                                            <div class="t-cell cell-desc">
                                                                <p style="widows: 100%;"> {{itemBOM.itemCode}} - {{itemBOM.itemName}}</p>
                                                            </div>
                                                            <div class="t-cell cell-total" style="max-width: 70px!important; cursor: pointer;">
                                                                <p>{{itemBOM.uomCode}} </p>
                                                            </div>
                                                            <div class="t-cell cell-quantity" style="max-width: 170px!important;">
                                                                <p>{{itemBOM.quantity | number}} </p>
                                                            </div>
                                                            <div class="t-cell cell-quantity" style="max-width: 170px!important;">

                                                            </div>
                                                            <div class="t-cell cell-total" style="max-width: 160px!important;">
                                                                <p>{{itemBOM.price | number}} </p>

                                                            </div>
                                                            <div class="t-cell cell-total" style="max-width: 160px!important;">
                                                                <p>{{itemBOM.price * itemBOM.quantity | number}} </p>
                                                            </div>
                                                            <div class="mr-2" style="min-width: 40px!important;">


                                                            </div>

                                                        </div>
                                                    </div>
                                                    <div [ngClass]="{ hideChildren : ele.class !== 'showChildren' }" #ele> 
                                                        <div class="t-row" *ngFor="let itemSerial of item.serialLines">
                                                            <div class="t-cell cell-action" style="max-width: 60px!important;">

                                                            </div>

                                                            <div class="t-cell cell-desc">
                                                                <p style="widows: 100%;"> {{itemSerial.serialNum}} </p>
                                                            </div>
                                                            <div class="t-cell cell-total" style="max-width: 60px!important;">
                                                                <p>{{itemSerial.uomCode}}</p>
                                                            </div>

                                                            <div class="t-cell cell-quantity" style="max-width: 170px!important; text-align: right">
                                                                <p>{{itemSerial.openQty | number}}</p>

                                                            </div>
                                                            <div class="t-cell cell-quantity" style="max-width: 170px!important; text-align: right">
                                                                <ng-container *ngIf="item.isSerial"> 
                                                                </ng-container>
                                                                <p>{{itemSerial.quantity | number}}</p>
                                                            </div>
                                                            <div class="t-cell cell-total" style="max-width: 160px!important;">

                                                            </div>
                                                            <div class="t-cell cell-total" style="max-width: 160px!important;">
                                                                <p>{{itemSerial.lineTotal | number}} </p>
                                                            </div>
                                                            <div class="mr-2" style="min-width: 40px!important;">


                                                            </div>

                                                        </div>
                                                    </div>
                                                </ng-container>
                                               
                                            </div> -->

                                            <div class="t-body mb-2" *ngIf="basket$ | async as basket">
                                                <ng-container *ngFor="let item of basket.items">
                                                    <!-- {{this.itemSelectedRow}} -->
                                                    <!-- || (item?.promotionIsPromo==='1' && item?.promotionType!=='Fixed Quantity')  -->
                                                    <div class="t-row" [ngClass]="{promotionLine: item.promotionIsPromo==='1' && item?.promotionType==='Fixed Quantity'}">
                                                        <div class="row actionrow" [ngClass]="{  hideChildren : this.itemSelectedRow !== item.id + item.uom+item.promotionPromoCode && action.class !== 'showChildren' }" #action id="rowAction" style="width:100%;">
                
                                                            <ng-container *ngIf="item?.promotionIsPromo==='1' && item?.promotionType==='Fixed Quantity' ">
                                                                <div class="col-md-3">
                
                                                                    <a class="nav-card active" (click)="this.itemSelectedRow = '' && action.class = action.class == 'showChildren' ? 'hideChildren' :  'showChildren'">
                                                                        <!-- <img class="custom-shop-house-icon mr-2" src="../../../../assets/images/System/setup.svg" alt="exit"> -->
                                                                        <i class="fas fa-chevron-circle-left fa-2x"></i>
                                                                        <span class="nav-card-text" style="text-transform: uppercase;"> {{'Back' | translate}}
                                            </span>
                                                                    </a>
                
                                                                </div>
                                                                <div class="col-md-9" style="    border-left: 1px solid;">
                                                                    <h5>{{item?.promotionPromoCode?.toString().slice(0,-1)}}</h5> {{item?.promotionPromoName}}
                                                                </div>
                
                                                            </ng-container>
                                                            <ng-container *ngIf="item?.promotionIsPromo!=='1'  || (item?.promotionIsPromo==='1' && item?.promotionType!=='Fixed Quantity')">
                                                                <div class="col-md-2">
                
                                                                    <a class="nav-card active" (click)="this.itemSelectedRow = '' && action.class = action.class == 'showChildren' ? 'hideChildren' :  'showChildren'">
                                                                        <!-- <img class="custom-shop-house-icon mr-2" src="../../../../assets/images/System/setup.svg" alt="exit"> -->
                                                                        <i class="fas fa-chevron-circle-left fa-2x"></i>
                                                                        <span class="nav-card-text" style="text-transform: uppercase;"> {{'Back' | translate}}
                                            </span>
                                                                    </a>
                
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <a class="nav-card active" (click)="remove(item)">
                                                                        <!-- <img class="custom-shop-house-icon mr-2" src="../../../../assets/images/System/setup.svg" alt="exit"> -->
                                                                        <!-- <a > <img src="../../../../assets/images/System/cancel.svg"> </a> -->
                                                                        <i class="fas fa-trash-alt fa-2x"></i>
                                                                        <span class="nav-card-text" style="text-transform: uppercase;"> {{'Remove' | translate}}
                                            </span>
                                                                    </a>
                
                
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <a class="nav-card active" *ngIf="item.isSerial" (click)="selectSerial(item)">
                                                                        <!-- <img class="custom-shop-house-icon mr-2" src="../../../../assets/images/System/setup.svg" alt="exit"> -->
                                                                        <i class="fas fa-info fa-2x"></i>
                                                                        <span class="nav-card-text" style="text-transform: uppercase;"> {{'Serial' | translate}}
                                            </span>
                                                                    </a>
                                                                    <!-- <a  (click)="selectSerial(item)"><i class="fas fa-info" *ngIf="item.isSerial" ></i></a> -->
                
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <dx-text-box [(ngModel)]="item.note" value="{{item.note}}" [showClearButton]="true" placeholder="Note" valueChangeEvent="keyup"></dx-text-box>
                
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <dx-button class="send" icon="check" (onClick)="updateNote(item)"> </dx-button>
                                                                </div>
                
                                                            </ng-container>
                                                        </div>
                
                                                        <div class="t-cell cell-action" style="max-width: 60px!important;">
                                                            <a>
                                                                <!-- <dx-button (click)="selectRow(item) && action.class = action.class == 'showChildren' ? 'hideChildren' :  'showChildren'" id="moreButton" icon="overflow" > </dx-button> -->
                                                                <!-- <img src="../../../../assets/images/System/file.svg"> -->
                                                                <!-- <i class="dx-icon-overflow" style="font-size: 25px;"></i> -->
                                                            </a>
                                                        </div>
                
                                                        <div class="t-cell cell-desc">
                
                                                            <p style="widows: 100%;">
                                                                <ng-container *ngIf="item.isSerial || item.isBOM">
                                                                    <i (click)="selectSerial(item)" class="fas fa-info" *ngIf="item.isSerial"></i>
                                                                    <i class="fas fa-archive" *ngIf="item.isBOM"></i> -
                                                                </ng-container>
                
                                                                {{item.productName}}
                                                            </p>
                                                            <br />
                 
                                                            <p>
                                                                <label class="mr-2">{{item.uom}}</label>
                                                                <label class="mr-2 textPromotion" style="float: right;" *ngIf="item?.promotionIsPromo==='1' && item?.promotionType==='Fixed Quantity'">Promotion Item</label>
                                                             
                                                                <ng-container *ngIf="item?.promotionPriceAfDis!==null && item?.promotionPriceAfDis!==item.price">
                                                                    <label class="mr-2 textOrigionalX"> {{item.price | number}}</label>
                                                                    <label class="mr-2 textPromotion"> {{item?.promotionPriceAfDis | number}} </label>
                
                
                
                                                                </ng-container>
                                                                <ng-container *ngIf="item?.promotionPriceAfDis===null || item?.promotionPriceAfDis===item.price">
                                                                    <label class="mr-2 textPromotion"> {{item.price | number}}</label>
                                                                </ng-container>
                                                                <ng-container *ngIf="item.customField1 === 'Card' && item?.promotionDisAmt!==null && item?.promotionDisAmt!==undefined">
                                                                    <label class="mr-2 textPromotion">+ {{item?.promotionDisAmt | number}} </label>
                                                                </ng-container>
                
                                                            </p>
                
                                                        </div>
                                                        <div class="t-cell cell-quantity" style="max-width: 40px!important; cursor: pointer;">
                                                       
                                                            <a class="text-center" (click)="ele.class = ele.class == 'showChildren' ? 'hideChildren' :  'showChildren'">
                                        <i class="fas fa-angle-down fa-2x" *ngIf="item.lineItems?.length > 0 || item.isBOM"></i>
                                      </a>
                                                    
                                                        </div>
                                                        <div class="t-cell cell-action text-right" style="max-width: 170px!important;">
                                                            {{item.oriQty}}
                                                        </div>
                
                
                                                        <div class="t-cell cell-quantity text-right" style="max-width: 170px!important;">
                                                            {{item.quantity}}
                                                       
                                                        </div>
                
                                                        <div class="t-cell cell-total text-right" style="max-width: 220px!important;">
                                                            <p>
                
                                                                <ng-container *ngIf="item?.promotionLineTotal!==null && item?.promotionLineTotal!==item.lineTotal">
                                                                    <label class="mr-2 textOrigionalX"> {{item.lineTotal | number}}</label>
                                                                    <br />
                                                                    <label class="mr-2 textPromotion"> {{item?.promotionLineTotal | number}}</label>
                
                                                                </ng-container>
                                                                <ng-container *ngIf="item?.promotionLineTotal===null || item?.promotionLineTotal===item.lineTotal">
                                                                    <label class="mr-2 textPromotion"> {{item?.lineTotal | number}}</label>
                                                                </ng-container>
                
                                                            </p>
                                                        </div>
                                                     
                
                                                    </div>
                
                
                                                    <div [ngClass]="{ hideChildren : ele.class !== 'showChildren' }" #ele>
                                                        <div class="t-row" *ngFor="let lineitem of item.lineItems">
                                                            <div class="t-cell cell-action" style="max-width: 60px!important;">
                                                                <p style="widows: 100%;" *ngIf="item.customField1 === 'Member' || item.customField1 === 'Class'"> {{'Date' | translate}}:
                                                                    
                                                                    <a class="nav-card active" (click)="removeCapacityLine(lineitem)">
                                                                        <i style="font-size: 20px;" class="ml-2 fas fa-trash-alt"></i>
                                                                  
                                                                    </a>
                                                                </p>
                                                            </div>
                
                                                            <div class="t-cell cell-desc">
                
                                                                <p style="widows: 100%;" *ngIf="item.isBOM"> {{lineitem.productName}} </p>
                                                                <p style="widows: 100%;" *ngIf="item.isSerial"> {{lineitem.serialNum}} </p>
                                                                <p style="widows: 100%;" *ngIf="item.isCapacity"> {{'Date' | translate}}: {{lineitem.appointmentDate | dateFormat }}, {{'Area' | translate}}: {{lineitem.storeAreaId}}
                                                                    <br /> {{'Time' | translate}}: {{lineitem.timeFrameId}} - {{lineitem.note}}
                                                                </p>
                                                                <p style="widows: 100%;" *ngIf="item.customField1 === 'Member' || item.customField1 === 'Class'"> {{'Date' | translate}}: {{lineitem.startDate | dateFormat }} ~ {{lineitem.endDate | dateFormat }}</p>
                                                                <p style="widows: 100%;" *ngIf="item.customField1 === 'Card' && item?.promotionDisAmt===null && item?.promotionDisAmt===undefined">
                                                                    {{'Card No' | translate}}: {{lineitem.prepaidCardNo}} </p>
                                                                <ng-container *ngIf="item.customField1 === 'Card' && item?.promotionDisAmt!==null && item?.promotionDisAmt!==undefined">
                                                                    {{'Card No' | translate}}: {{lineitem.prepaidCardNo}} <label class="mr-2 textPromotion"> + {{lineitem.promotionDisAmt}}</label>
                                                                </ng-container>
                                                            </div>
                                                            <div class="t-cell cell-quantity" style="max-width: 40px!important; cursor: pointer;">
                 
                                                            </div>
                                                            <div class="t-cell cell-quantity" style=" text-align: right; max-width: 170px!important;">
                                                                
                                                            </div>
                                                            <div class="t-cell cell-total" s style=" text-align: right; max-width: 170px!important;">
                                                             
                                                                <p *ngIf="item.isCapacity ">{{lineitem.quantity | number}} </p>
                                                                <p *ngIf="item.customField1 === 'Member' || item.customField1 === 'Class'">{{lineitem.quantity | number}} </p>
                                                                <p *ngIf="item.customField1 === 'Card' ">{{lineitem.memberValue | number}} </p>
                                                                <p *ngIf="item.isBOM">{{lineitem.lineTotal | number}} </p>
                                                                <p *ngIf="item.isSerial">{{lineitem.quantity | number}} </p>
                                                            </div>
                                                            <div class="t-cell cell-total" style=" max-width: 220px!important;">
                
                
                                                            </div>
                                                            
                                                        </div>
                                                    </div>
                                                </ng-container>
                
                                            </div>
                                        </div>
                                    </div>
                                    <div class="total-bill mt-4">
                                        <div class="row">
                                            <!-- <div class="col-md-5 ">
                                                <div class="discount-div">
                                                    <p>{{'Bill Total' | translate}}</p>
                                                    <p>{{ (paymentTotal$ | async).oriTotalAmount | number}}</p>
                                                    
                                                </div>
                                                <div class="discount-div">
                                                   <p>{{'Discount Amount' | translate}}</p>

                                                     <p *ngIf="(paymentTotal$ | async).oriDiscountAmount !== (paymentTotal$ | async).oriTotalAmount - (paymentTotal$ | async).totalAmount">
                                                        <span class="textOrigionalX">
                                                            {{ (paymentTotal$ | async).oriDiscountAmount| number}} 
                                                        </span>
                                                        <span class="textPromotion">
                                                            {{ (paymentTotal$ | async).oriTotalAmount - (paymentTotal$ | async).totalAmount | number}}
                                                        </span>
                                                    </p>
                                                    <p *ngIf="(paymentTotal$ | async).oriDiscountAmount === (paymentTotal$ | async).oriTotalAmount - (paymentTotal$ | async).totalAmount">
                                                        <span class="textPromotion">
                                                            {{ (paymentTotal$ | async).oriDiscountAmount| number}} 
                                                        </span>

                                                    </p>
                                                </div>
                                                <div class="discount-div">
                                                    <p>{{'Total Payable' | translate}}</p>
                                                    <p>{{ (paymentTotal$ | async).totalAmount | number}}</p> 
                                                </div>
                                                <div class="discount-div">
                                                    <p>{{'Total Collected' | translate}}</p>
                                                    <p>{{ (paymentTotal$ | async).totalCollected | number}}</p>
                                                </div>

                                                <div class="payable-div">
                                                    <p>{{'Total Left Amount' | translate}}</p>
                                                    <p>{{(paymentTotal$ | async).leftAmount| number}}</p>
                                                </div>
                                                <div class="payable-div">
                                                    <p>{{'Total Change Amount' | translate}}</p>
                                                    <p>{{(paymentTotal$ | async).changeAmount| number}}</p>
                                                </div>
                                            </div> -->
                                            <div class="col-md-5 ">
                                                <!-- {{(basketTotal$ | async) | json}} -->
                                                <div class="discount-div">
                                                    <p>{{'Bill Total' | translate}}</p>
                                                  
                                                    <p>{{(basketTotal$ | async)?.billTotal | number}}</p>
                                                </div>
                                                <div class="discount-div">
                                                   <p>{{'Discount Amount' | translate}}</p>

                                                     <!-- <p *ngIf="(paymentTotal$ | async).oriDiscountAmount !== (paymentTotal$ | async).oriTotalAmount - (paymentTotal$ | async).totalAmount">
                                                        <span class="textOrigionalX">
                                                            {{ (paymentTotal$ | async).oriDiscountAmount| number}} 
                                                        </span>
                                                        <span class="textPromotion">
                                                            {{ (paymentTotal$ | async).oriTotalAmount - (paymentTotal$ | async).totalAmount | number}}
                                                        </span>
                                                    </p>
                                                    <p *ngIf="(paymentTotal$ | async).oriDiscountAmount === (paymentTotal$ | async).oriTotalAmount - (paymentTotal$ | async).totalAmount">
                                                        <span class="textPromotion">
                                                            {{ (paymentTotal$ | async).oriDiscountAmount| number}} 
                                                        </span>

                                                    </p> -->
                                                    <p  > <span *ngIf="(basketTotal$ | async)?.discountBillValue > 0">-</span> {{(basketTotal$ | async)?.discountBillValue | number}}</p>
                                                </div>
                                                <div class="discount-div">
                                                    <p>{{'Total Payable' | translate}}</p>
                                                    <!-- <p>{{ (paymentTotal$ | async).totalAmount | number}}</p> -->
                                                      <p >
                                                        <span *ngIf="  (basket$ | async)?.negativeOrder || ((basket$ | async)?.salesType?.toLowerCase() === 'return' &&  (basketTotal$ | async)?.total !== 0)">-</span>
                                                        {{(basketTotal$ | async)?.total | number}}
                                                    </p>
                                                </div>
                                                <!-- {{(basketTotal$ | async) | json}} -->
                                                <div class="discount-div">
                                                    <p>{{'Total Collected' | translate}}</p>
                                                    <!-- <p>{{ (basketTotal$ | async).charged | number}}</p> -->
                                                    <p>{{ (basketTotal$ | async)?.totalAmount| number}}</p>
                                                </div>

                                                <div class="payable-div">
                                                    <p>{{'Total Left Amount' | translate}}</p>
                                                    <p>{{(basketTotal$ | async)?.amountLeft| number}}</p>
                                                </div>
                                                <div class="payable-div">
                                                    <p>{{'Total Change Amount' | translate}}</p>
                                                    <p>{{(basketTotal$ | async)?.changeAmount| number}}</p>
                                                </div> 
                                            </div>
                                            <div class="col-md-7">
                                                <div class="row">
                                                    <div class="col-md-3"></div>
                                                    <div class="col-md-3"></div>
                                                    <div class="col-md-3">
                                                        <a class="primary-btn col-md-12 mr-2" (click)="print()">{{'Print' | translate}}</a>
                                                       
                                                    </div>
                                                    <!-- <div class="col-md-3">

                                                        <a class="primary-btn col-md-12" (click)="openModal(template)"> 
                                                            {{'Payment' | translate}}
                                                        </a>
                                                    </div> -->
                                                    <div class="col-md-3">
                                                        
                                                        <a class="primary-btn col-md-12" (click)="openPaymentModal(templatePayment)"> 
                                                            {{'Payment' | translate}}
                                                        </a>
                                                    </div>
                                                    
                                                </div>


                                            </div>

                                        </div>


                                    </div>
                                    <!-- <div class="total-bill">
              <div class="row"> 
                 
                <div class="col-md-6">
                  <div class="discount-div">
                    <p>Bill Total</p>
                    <p>{{ this.invoice?.totalAmount | number}}</p>
                  </div>
                 
                  <div class="discount-div" >
                    <p>Total Discount</p>
                    <p>{{this.invoice?.totalDiscountAmt | number}}</p>
                  </div>
                 
                  <div class="payable-div">
                    <p>Total Payable</p>
                    <p>{{this.invoice?.totalReceipt| number}}</p>
                  </div>
                </div> 
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-6">
                   
                    </div>
                    <div class="col-md-6">
                      <a  class="primary-btn" (click)="saveEntity()" >Payment</a>
                    </div>
                  </div>
                 
                
                </div>
               
              </div>
             
              
            
            </div> -->
                                </div>

                            </ng-container>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #templatePayment>
    <app-shop-bill-payment (Modal)="saveEntityNew($event)"></app-shop-bill-payment>
</ng-template>

<ng-template #template>
    <!-- <app-shop-bill-payment (Modal)="addOrder($event)"></app-shop-bill-payment> -->
    <div class="modal-header">
        <h4 class="modal-title pull-left" id="my-modal-title">{{'Payment' | translate}}</h4>

        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">

      <img src="../../../assets/images/System/times.svg">
    </button>
    </div>

    <div class="modal-body" *ngIf="showModal">

        <div class="row">
            <div class="col-md-12 mb-2">
                <div class="grey-wrapper left-modal-section">
                    <div class="table-wrap">
                        <div class="payment-modal-table custom-table horizontal-scroll">
                            <div class="t-head">
                                <div class="t-row">

                                    <div class="t-cell cell-payment">
                                        <p>{{'Payment Method' | translate}}</p>
                                    </div>
                                    <div class="t-cell cell-charged">
                                        <p>{{'Chargable' | translate}}</p>
                                    </div>
                                    <div class="t-cell cell-amount">
                                        <p>{{'Collected' | translate}}</p>
                                    </div>
                                    <div class="t-cell cell-ref">
                                        <p>{{'Ref. Number' | translate}}</p>
                                    </div>

                                </div>
                            </div>

                            <div class="t-body vertical-scroll mb-2" style="    min-height: 40px;">

                                <div class="t-row" *ngFor="let payment of this.chargedPayment ; let i = index">

                                    <div class="t-cell cell-payment">
                                        <p>{{payment.paymentCode}}</p>
                                    </div>

                                    <div class="t-cell cell-charged">

                                        <p>{{payment.chargableAmount | number}}</p>
                                    </div>
                                    <div class="t-cell cell-amount">
                                        <p>{{payment.collectedAmount | number }}</p>

                                    </div>

                                    <div class="t-cell cell-ref">
                                        <p>{{payment.refNumber}}</p>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>


                </div>

            </div>
            <div class="col-12 col-lg-7 " *ngIf=" this.isPayment===true">
                <div class="grey-wrapper left-modal-section">
                    <div class="table-wrap">
                        <div class="payment-modal-table custom-table horizontal-scroll">
                            <div class="t-head">
                                <div class="t-row">
                                    <div class="t-cell cell-action"></div>
                                    <div class="t-cell cell-payment">
                                        <p>{{'Payment Method' | translate}}</p>
                                    </div>
                                    <div class="t-cell cell-charged">
                                        <p>{{'Chargable' | translate}}</p>
                                    </div>
                                    <div class="t-cell cell-amount">
                                        <p>{{'Collected' | translate}}</p>
                                    </div>

                                    <div class="t-cell cell-ref">
                                        <p>{{'Ref. Number' | translate}}</p>
                                    </div>

                                </div>
                            </div>

                            <div class="t-body vertical-scroll mb-2" style="min-height: 300px;">

                                <div class="t-row" *ngFor="let payment of this.order.payments ; let i = index" [class.selectRow]="i==this.selectedRow">
                                    <div class="t-cell cell-action">
                                        <a href="javascript:void" class="delete-btn" (click)="removePayment(payment)">
                                            <img src="../../../../assets/images/System/close.svg" alt="close">
                                        </a>

                                    </div>
                                    <div class="t-cell cell-payment">
                                        <p>{{payment.paymentCode}}</p>
                                    </div>

                                    <div class="t-cell cell-charged">

                                        <p>{{payment.chargableAmount | number}}</p>
                                    </div>
                                    <div class="t-cell cell-amount">

                                        <div class="search-wrap typing-section-input-wrap inputAmount">
                                            <input type="text" #input type="text" value="{{payment.collectedAmount | number}}" (change)="inputNumFix(input.value, false)" (keyup)="inputNumFix(input.value, false)" (focus)="setClickedRow(i, payment)" placeholder="Amount" class="typing-section-input txtAmount">
                                            <!-- <img class="clear-input" style="right: 5%;" *ngIf="i==this.selectedRow" #txtInput src="../../../../assets/images/System/close.svg" (click)="removePayment(payment)" alt="clear"> -->
                                        </div>
                                    </div>
                                    <div class="t-cell cell-ref">

                                        <div class="search-wrap typing-section-input-wrap inputAmount">
                                            <label *ngIf="payment.isRequire">
                        {{payment.refNumber }}
                        <p *ngIf="payment.paymentCode=='PrepaidCard'">{{payment.mainBalance |
                          number}}/{{payment.subBalance | number}}</p>
                      </label>
                                            <ng-container *ngIf="!payment.isRequire">
                                                <input type="text" #input2 type="text" value="{{payment.refNumber }}" (change)="changeValuePayment(input.value, i, payment, 'refNum')" (keyup)="changeValuePayment(input.value, i, payment, 'refNum')" placeholder="{{'Ref Number' | translate}}" (focus)="setClickedRow(i, payment, 'refNum')"
                                                    class="typing-section-input txtAmount">
                                                <a *ngIf="i==this.selectedRow" (click)="clearRefNumPayment(payment)"><i
                            class="fas fa-eraser"></i></a>
                                            </ng-container>
                                        </div>
                                    </div>


                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="modal-payment-info">
                        <div>
                            <label>{{'Bill Amount' | translate}}</label>
                            <p>{{ (paymentTotal$ | async).totalAmount | number}}</p>
                            <!-- <p>{{this.order?.totalAmount | number}}</p> -->
                        </div>
                        <div>
                            <label>{{'Total Discount' | translate}}</label>
                            <!-- <p>{{this.order?.paymentDiscount | number}}</p> -->
                            <p>{{ (paymentTotal$ | async).discountAmount | number}}</p>
                        </div>
                        <div>
                            <label>{{'Total Chargable' | translate}}</label>
                            <p>{{ (paymentTotal$ | async).chargableAmount | number}}</p>
                            <!-- <p> {{this.order?.totalPayable - this.order?.paymentDiscount | number}}</p> -->
                        </div>
                        <div>
                            <label>{{'Total Collected' | translate}}</label>
                            <p>{{ (paymentTotal$ | async).totalCollected | number}}</p>
                            <!-- <p>{{this.order?.totalReceipt  | number}}</p> -->
                        </div>

                        <div>
                            <!-- Amount Left -->
                            <label>{{'Balance Due' | translate}}</label>
                            <p>{{ (paymentTotal$ | async).leftAmount | number}}</p>
                            <!-- <p>0</p> -->
                        </div>
                        <div>
                            <label>{{'Change' | translate}}</label>
                            <p>{{ (paymentTotal$ | async).changeAmount | number}}</p>
                            <!-- <p>{{this.order?.amountChange | number}}</p> -->
                        </div>
                    </div>

                </div>
                <div class="modal-discount-btn-wrap">
                    <ng-container *ngFor="let item of this.denolist">
                        <button class="btn-discount-amount mb-3" (click)="inputNumFix(item.value, true)">{{item.value | currencyFormat}}</button>
                    </ng-container>
                </div>
            </div>
            <div class="col-12 col-lg-5" *ngIf=" this.isPayment===true">
                <div class="grey-wrapper right-modal-section">
                    <div class="typing-section">
                        <div class="number-pad" *ngIf="isShowOtherPayment">
                            <div class="row" style="    min-height: 50vh;">
                                <div class="number-div" *ngFor="let payment of this.paymentMethodOtherList">
                                    <button class="pay-option-btn" (click)="addPayment(payment, true, payment.isRequireRefnum)">{{payment.paymentDesc}}</button>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-12" style="padding: 0px 5px;">
                                    <div class="action-section">


                                        <button type="reset" class="reset-btn mr-1" (click)="closeOtherPad()" style="    width: 23%;">
                      <i class="fas fa-window-close"></i>

                    </button>

                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="number-pad" *ngIf="!isShowOtherPayment">
                            <div class="row">
                                <div class="col-md-9">
                                    <div class="row">
                                        <div class="col-md-4 number-div">

                                            <button class="number-btn" (click)="pressKey('1')">1</button>

                                        </div>
                                        <div class="col-md-4 number-div">

                                            <button class="number-btn" (click)="pressKey('2')">2</button>

                                        </div>
                                        <div class="col-md-4 number-div">

                                            <button class="number-btn" (click)="pressKey('3')">3</button>

                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('4')">4</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('5')">5</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('6')">6</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('7')">7</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('8')">8</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('9')">9</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('0')">0</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('.')">.</button>
                                        </div>
                                        <div class="col-md-4 number-div">
                                            <button class="number-btn" (click)="pressKey('000')"><i class="fas fa-arrow-right"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 ">
                                    <div class="row">
                                        <div class="col-md-12 number-div" *ngFor="let payment of this.paymentMethodShowList">
                                            <button class="pay-option-btn" (click)="addPayment(payment , null , payment.isRequireRefnum)">{{payment.paymentDesc}}</button>
                                        </div>

                                        <div class="col-md-12 number-div">
                                            <button class="pay-option-btn" (click)="showOtherPayment()"> {{'Other' | translate}}</button>
                                        </div>
                                    </div>

                                </div>
                                <div class="number-div submit-div">
                                    <button class="submit-btn" (click)="saveEntity()"> {{'Submit' | translate}}</button>
                                    <!-- <button class="submit-btn" (click)="addOrder()" >Add Order</button> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</ng-template>


<ng-template #ManualPromotion>
    <div id='discount-modal'>
        <div class="modal-header">
            <h4 class="modal-title pull-left" id="my-modal-title">{{'Promotion' | translate}} / {{'Discount' | translate}}</h4>
            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <img src="../../../assets/images/System/times.svg">
      </button>
        </div>
        <div class="modal-body">
            <div class="row">

                <div class="col-lg-12">
                    <div class="grey-wrapper left-modal-section">
                        <div class="table-wrap horizontal-scrol">
                            <div class="discount-modal-table custom-table l">
                                <div class="t-head">
                                    <div class="t-row">
                                        <div class="t-cell cell-item">
                                            <p>{{'Item Code' | translate}}</p>
                                        </div>
                                        <div class="t-cell cell-desc">
                                            <p>{{'Description' | translate}}</p>
                                        </div>
                                        <div class="t-cell cell-uom">
                                            <p>{{'UoM' | translate}}</p>
                                        </div>
                                        <div class="t-cell cell-price">
                                            <p>{{'Price' | translate}}</p>
                                        </div>
                                        <div class="t-cell cell-quantity">
                                            <p>{{'Quantity' | translate}}</p>
                                        </div>

                                        <div class="t-cell cell-discount">
                                            <p>{{'Discount' | translate}}</p>
                                        </div>
                                        <div class="t-cell cell-subsotal">
                                            <p>{{'Subtotal' | translate}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="t-body vertical-scroll mb-2" style="min-height: 300px;">

                                    <div class="t-row" *ngFor="let item of this.invoice?.lines; let i = index">
                                        <div class="t-cell cell-item">
                                            <p>{{item?.itemCode}}</p>
                                        </div>
                                        <div class="t-cell cell-desc">
                                            <p>
                                                {{item?.itemName}}
                                            </p>
                                        </div>
                                        <div class="t-cell cell-uom">
                                            <p> {{item?.uomCode }}</p>
                                        </div>
                                        <div class="t-cell cell-price">
                                            <p>{{item?.price | number}}</p>
                                        </div>
                                        <div class="t-cell cell-quantity">
                                            <p>{{item?.quantity | number}}</p>
                                        </div>
                                        <!-- <div class="t-cell cell-quantity">
                      <p>{{item.discountType}}</p>
                    </div> -->
                                        <div class="t-cell cell-discount">
                                            <p>{{item?.discountAmt | number}}</p>
                                        </div>
                                        <div class="t-cell cell-subsotal">
                                            <p>{{item?.quantity * item?.price - item?.discountAmt | number}}</p>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="modal-payment-info">
                            <div>
                                <label>{{'Bill Discount' | translate}}</label>

                            </div>

                            <p>{{this.invoice?.discountRate == null ? 0 : this.invoice?.discountRate | number}}</p>
                            <div>
                                <label>{{'Bill Amount' | translate}}</label>
                                <p>{{this.order?.totalAmount | number}}</p>
                            </div>
                            <div>
                                <label>{{'Total Discount' | translate}}</label>
                                <p>{{this.invoice?.totalDiscountAmt == null ? 0 : this.invoice?.totalDiscountAmt | number}}</p>
                            </div>
                            <div>
                                <label>{{'Total Amount' | translate}}</label>
                                <p>{{ this.order?.totalReceipt | number}}</p>
                            </div>

                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

</ng-template>